FROM python:3.10-slim

# å®‰è£…æ„å»º numpy wheel æ‰€éœ€çš„åŸºæœ¬ä¾èµ–
RUN apt-get update && apt-get install -y \
    libgl1 \
    libglib2.0-0 \
    build-essential \
    python3-dev \
    libatlas-base-dev \
    gfortran \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY . /app

# å‡çº§ pip + setuptools + wheelï¼Œå¼ºåˆ¶å®‰è£… numpy
RUN pip install --upgrade pip setuptools wheel

# ğŸ‘‡ å…³é”®ç‚¹ï¼šå•ç‹¬æå‰è£… numpyï¼Œé¿å…å®ƒå‚ä¸ pyproject.toml ç¼–è¯‘
RUN pip install "numpy==1.23.5" --no-deps

# ç„¶åå†è£…å…¶ä»–ä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

RUN pip install "numpy==1.23.5" --no-deps

# âœ… ä¾èµ–å¥åº·æ£€æŸ¥
RUN python -c "from deepface import DeepFace; import cv2; print('âœ… all dependencies loaded')"

EXPOSE 5000
CMD ["python", "app/main.py"]

